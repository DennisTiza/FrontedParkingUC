<div class="registro-container">
  <h2>Registro de Vehículo</h2>

  @if (errorMessage) {
    <div class="error-message">
      {{ errorMessage }}
    </div>
  }

  @if (successMessage) {
    <div class="success-message">
      {{ successMessage }}
    </div>
  }

  <form [formGroup]="fGroup" (ngSubmit)="registrarVehiculo()" class="registro-form">

    <!-- Tipo (primero para determinar formato de placa) -->
    <div class="form-group">
      <label for="tipo">Tipo de Vehículo</label>
      <select
        id="tipo"
        formControlName="tipo"
        [class.error]="ObtenerFormGroup['tipo']?.invalid && ObtenerFormGroup['tipo']?.touched"
      >
        <option value="">Seleccione el tipo</option>
        @for (tipo of tiposVehiculo; track tipo) {
          <option [value]="tipo">{{ tipo }}</option>
        }
      </select>

      @if (ObtenerFormGroup['tipo']?.invalid && ObtenerFormGroup['tipo']?.touched) {
        <div class="validation-error">
          @if (ObtenerFormGroup['tipo']?.errors?.['required']) {
            <div>El tipo de vehículo es requerido</div>
          }
        </div>
      }
    </div>

    <!-- Placa -->
    <div class="form-group">
      <label for="placa">Placa</label>
      <input
        type="text"
        id="placa"
        formControlName="placa"
        placeholder="Ingrese la placa"
        [class.error]="ObtenerFormGroup['placa']?.invalid && ObtenerFormGroup['placa']?.touched"
        style="text-transform: uppercase;"
      />

      @if (ObtenerFormGroup['placa']?.invalid && ObtenerFormGroup['placa']?.touched) {
        <div class="validation-error">
          @if (ObtenerFormGroup['placa']?.errors?.['required']) {
            <div>La placa es requerida</div>
          }
          @if (ObtenerFormGroup['placa']?.errors?.['minlength']) {
            <div>La placa debe tener al menos 4 caracteres</div>
          }
          @if (ObtenerFormGroup['placa']?.errors?.['formatoPlacaCarro']) {
            <div>Formato inválido para CARRO. Debe ser: ABC123 o ABC1234 (3 letras + 3 o 4 números)</div>
          }
          @if (ObtenerFormGroup['placa']?.errors?.['formatoPlacaMoto']) {
            <div>Formato inválido para MOTO. Debe ser: ABC12D o ABC12 (3 letras + 2 números + opcional 1 letra)</div>
          }
        </div>
      }
      @if (ObtenerFormGroup['tipo']?.value) {
        <small class="info-text">
          @if (ObtenerFormGroup['tipo']?.value === 'CARRO') {
            Formato: ABC123 o ABC1234
          } @else if (ObtenerFormGroup['tipo']?.value === 'MOTO') {
            Formato: ABC12D o ABC12
          }
        </small>
      }
    </div>

    <!-- Marca -->
    <div class="form-group">
      <label for="marca">Marca</label>
      <input
        type="text"
        id="marca"
        formControlName="marca"
        placeholder="Ingrese la marca"
        [class.error]="ObtenerFormGroup['marca']?.invalid && ObtenerFormGroup['marca']?.touched"
      />

      @if (ObtenerFormGroup['marca']?.invalid && ObtenerFormGroup['marca']?.touched) {
        <div class="validation-error">
          @if (ObtenerFormGroup['marca']?.errors?.['required']) {
            <div>La marca es requerida</div>
          }
        </div>
      }
    </div>

    <!-- Modelo -->
    <div class="form-group">
      <label for="modelo">Modelo</label>
      <input
        type="text"
        id="modelo"
        formControlName="modelo"
        placeholder="Ingrese el modelo"
        [class.error]="ObtenerFormGroup['modelo']?.invalid && ObtenerFormGroup['modelo']?.touched"
      />

      @if (ObtenerFormGroup['modelo']?.invalid && ObtenerFormGroup['modelo']?.touched) {
        <div class="validation-error">
          @if (ObtenerFormGroup['modelo']?.errors?.['required']) {
            <div>El modelo es requerido</div>
          }
        </div>
      }
    </div>

    <!-- Color -->
    <div class="form-group">
      <label for="color">Color</label>
      <input
        type="text"
        id="color"
        formControlName="color"
        placeholder="Ingrese el color"
        [class.error]="ObtenerFormGroup['color']?.invalid && ObtenerFormGroup['color']?.touched"
      />

      @if (ObtenerFormGroup['color']?.invalid && ObtenerFormGroup['color']?.touched) {
        <div class="validation-error">
          @if (ObtenerFormGroup['color']?.errors?.['required']) {
            <div>El color es requerido</div>
          }
        </div>
      }
    </div>

    <!-- Fecha de Caducidad -->
    <div class="form-group">
      <label for="fechaCaducidad">Fecha de Caducidad</label>
      <input
        type="date"
        id="fechaCaducidad"
        formControlName="fechaCaducidad"
        [class.error]="ObtenerFormGroup['fechaCaducidad']?.invalid && ObtenerFormGroup['fechaCaducidad']?.touched"
      />

      @if (ObtenerFormGroup['fechaCaducidad']?.invalid && ObtenerFormGroup['fechaCaducidad']?.touched) {
        <div class="validation-error">
          @if (ObtenerFormGroup['fechaCaducidad']?.errors?.['required']) {
            <div>La fecha de caducidad es requerida</div>
          }
        </div>
      }
    </div>

    <!-- Código del Conductor -->
    <div class="form-group">
      <label for="conductorCodigo">Código del Conductor</label>
      <input
        type="text"
        id="conductorCodigo"
        formControlName="conductorCodigo"
        placeholder="Ingrese el código del conductor"
        [class.error]="ObtenerFormGroup['conductorCodigo']?.invalid && ObtenerFormGroup['conductorCodigo']?.touched"
      />

      @if (ObtenerFormGroup['conductorCodigo']?.invalid && ObtenerFormGroup['conductorCodigo']?.touched) {
        <div class="validation-error">
          @if (ObtenerFormGroup['conductorCodigo']?.errors?.['required']) {
            <div>El código del conductor es requerido</div>
          }
        </div>
      }
    </div>

    <!-- Botón -->
    <button type="submit" class="btn-registrar" [disabled]="fGroup.invalid">
      Registrar Vehículo
    </button>
  </form>
</div>